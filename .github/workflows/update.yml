name: Update Amtrak files

on:
   workflow_call:

jobs:
   upload-release-asset:
     runs-on: ubuntu-latest
     permissions:
       contents: write
       packages: write

     steps:
       - name: Checkout code
         uses: actions/checkout@v3

       - name: Download unzip and zip
         run: sudo apt install unzip zip

       - uses: actions-rust-lang/setup-rust-toolchain@v1
       
       - name: Process
         run: cargo run --release

       - name: Rezip
         run: |
          (cd amtrak-gtfs && zip -r "$OLDPWD/amtrak-gtfs-fixed.zip" .)

       - name: Upload Asset
         env:
          GITHUB_TOKEN: ${{ secrets.GITUHB_TOKEN }}
          GH_TOKEN: ${{ github.token }}
          ASSET_PATH: amtrak-gtfs-fixed.zip # Replace with the actual path to your file
          ASSET_NAME: amtrak-gtfs-fixed.zip # Replace with the desired name of the asset
          RELEASE_TAG: latest
         run: |
          echo "Uploading asset: $ASSET_PATH as $ASSET_NAME to release latest"
          gh release upload latest "$ASSET_PATH" --clobber
         shell: bash
         if: env.ASSET_PATH != '' && env.ASSET_NAME != ''